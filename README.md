# ComfyUI YOLO Mask Process

ä¸€ä¸ªå¼ºå¤§çš„ComfyUIè‡ªå®šä¹‰èŠ‚ç‚¹é¡¹ç›®ï¼Œé›†æˆäº†YOLOv8ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²åŠŸèƒ½ï¼Œå¹¶æä¾›çµæ´»çš„å›¾åƒé®ç½©æ•ˆæžœå¤„ç†ã€‚

## ðŸš€ åŠŸèƒ½ç‰¹æ€§

### YOLO Detection and Segmentation èŠ‚ç‚¹
- **å¤šæ¨¡åž‹æ”¯æŒ**ï¼šæ”¯æŒYOLOv8æ£€æµ‹å’Œåˆ†å‰²æ¨¡åž‹ï¼ˆyolov8n.pt, yolov8s.ptç­‰ï¼‰
- **æ™ºèƒ½æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å›¾åƒä¸­çš„ç›®æ ‡å¹¶ç”Ÿæˆè¾¹ç•Œæ¡†å’Œç½®ä¿¡åº¦åˆ†æ•°
- **åˆ†å‰²æ”¯æŒ**ï¼šæ”¯æŒå®žä¾‹åˆ†å‰²ï¼Œç”Ÿæˆé«˜è´¨é‡çš„åˆ†å‰²æŽ©ç 
- **çµæ´»è¿‡æ»¤**ï¼šæ”¯æŒæŒ‰ç±»åˆ«IDæˆ–ç±»åˆ«åç§°è¿‡æ»¤ç‰¹å®šç›®æ ‡ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
- **ç½®ä¿¡åº¦æŽ§åˆ¶**ï¼šå¯è°ƒèŠ‚æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼ (0.0-1.0)
- **æŽ©ç å¹³æ»‘**ï¼šå¯é€‰çš„é«˜æ–¯å¹³æ»‘åŠŸèƒ½ï¼Œæå‡æŽ©ç è¾¹ç¼˜è´¨é‡ï¼ˆ0.0-10.0å¼ºåº¦æŽ§åˆ¶ï¼‰
- **å¼ºåˆ¶æŽ©ç è¾“å‡º**ï¼šå½“åˆ†å‰²æ¨¡åž‹æ— æŽ©ç æ—¶ï¼Œå¯ä½¿ç”¨è¾¹ç•Œæ¡†è‡ªåŠ¨ç”ŸæˆæŽ©ç 
- **è‡ªåŠ¨å°ºå¯¸é€‚é…**ï¼šè‡ªåŠ¨å¤„ç†æ¨¡åž‹è¾“å‡ºä¸Žè¾“å…¥å›¾åƒå°ºå¯¸ä¸åŒ¹é…çš„é—®é¢˜
- **å¤šè¾“å‡ºæ¨¡å¼**ï¼š
  - å¸¦æ ‡æ³¨å›¾åƒï¼ˆè¾¹ç•Œæ¡†å’Œç±»åˆ«æ ‡ç­¾ï¼‰
  - å•ä¸ªåˆå¹¶æŽ©ç ï¼ˆå¯æŒ‰ç±»åˆ«è¿‡æ»¤ï¼‰
  - æ‰€æœ‰ç‹¬ç«‹å®žä¾‹æŽ©ç 
  - è¯¦ç»†æ£€æµ‹ç»“æžœJSONï¼ˆåŒ…å«ç±»åˆ«ã€ç½®ä¿¡åº¦ã€è¾¹ç•Œæ¡†ç­‰å…ƒæ•°æ®ï¼‰

### Masked Image Effects èŠ‚ç‚¹
- **å¤šæ ·æ•ˆæžœ**ï¼šæ”¯æŒé«˜æ–¯æ¨¡ç³Šã€é©¬èµ›å…‹ç­‰å›¾åƒç‰¹æ•ˆ
- **çµæ´»åº”ç”¨åŒºåŸŸ**ï¼šå¯åº”ç”¨äºŽé®ç½©ç™½è‰²åŒºåŸŸ(masked_area)æˆ–é»‘è‰²åŒºåŸŸ(unmasked_area)
- **æ™ºèƒ½å°ºå¯¸é€‚é…**ï¼šè‡ªåŠ¨å¤„ç†è¾“å…¥æŽ©ç ä¸Žå›¾åƒå°ºå¯¸ä¸åŒ¹é…çš„æƒ…å†µ
- **å‚æ•°ç²¾ç¡®æŽ§åˆ¶**ï¼š
  - é©¬èµ›å…‹ï¼šåƒç´ å—å¤§å°æŽ§åˆ¶(2-256)
  - é«˜æ–¯æ¨¡ç³Šï¼šæ ¸å¤§å°(3-255ï¼Œå¿…é¡»å¥‡æ•°)å’Œæ ‡å‡†å·®(0.1-20.0)
- **å¤šåŽç«¯æ”¯æŒ**ï¼šä¼˜å…ˆä½¿ç”¨torchvisionï¼Œè‡ªåŠ¨é™çº§åˆ°PILå®žçŽ°
- **å®žæ—¶é¢„è§ˆ**ï¼šæ”¯æŒComfyUIå®žæ—¶é¢„è§ˆå¤„ç†æ•ˆæžœ
- **å†…å­˜ä¼˜åŒ–**ï¼šé«˜æ•ˆçš„å¼ é‡æ“ä½œï¼Œå‡å°‘å†…å­˜å ç”¨

## ðŸ“¦ å®‰è£…æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®åˆ°ComfyUIçš„custom_nodesç›®å½•
cd ComfyUI/custom_nodes
git clone https://github.com/gasdyueer/comfyui-yolo-mask-process.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd comfyui-yolo-mask-process

# å®‰è£…Pythonä¾èµ–ï¼ˆæŽ¨èä½¿ç”¨requirements.txtï¼‰
pip install -r requirements.txt

# æˆ–è€…æ‰‹åŠ¨å®‰è£…æ ¸å¿ƒä¾èµ–
pip install ultralytics>=8.2.0 torch torchvision scipy pillow numpy

# å¯é€‰ï¼šå®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"
```

### ä¾èµ–è¯´æ˜Žï¼š
- **ultralytics**: YOLOv8æ¨¡åž‹æŽ¨ç†å¼•æ“Ž
- **torch & torchvision**: æ·±åº¦å­¦ä¹ æ¡†æž¶å’Œå›¾åƒå¤„ç†
- **scipy**: ç§‘å­¦è®¡ç®—ï¼Œç”¨äºŽæŽ©ç å¹³æ»‘
- **pillow**: å›¾åƒå¤„ç†åŸºç¡€åº“
- **numpy**: æ•°å€¼è®¡ç®—æ”¯æŒ

### 2. ä¸‹è½½YOLOv8æ¨¡åž‹

å°†YOLOv8æ¨¡åž‹æ–‡ä»¶æ”¾å…¥ `ComfyUI/models/YOLO_MODEL/` ç›®å½•ï¼š

```bash
# åˆ›å»ºæ¨¡åž‹ç›®å½•
mkdir -p ComfyUI/models/YOLO_MODEL

# ä¸‹è½½æ¨¡åž‹ï¼ˆé€‰æ‹©é€‚åˆæ‚¨éœ€æ±‚çš„å¤§å°å’Œç±»åž‹ï¼‰
# æ£€æµ‹æ¨¡åž‹ - ç”¨äºŽç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†ç”Ÿæˆ
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8n.pt -O ComfyUI/models/YOLO_MODEL/yolov8n.pt
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8s.pt -O ComfyUI/models/YOLO_MODEL/yolov8s.pt
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8m.pt -O ComfyUI/models/YOLO_MODEL/yolov8m.pt

# åˆ†å‰²æ¨¡åž‹ - ç”¨äºŽå®žä¾‹åˆ†å‰²å’ŒæŽ©ç ç”Ÿæˆ
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8n-seg.pt -O ComfyUI/models/YOLO_MODEL/yolov8n-seg.pt
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8s-seg.pt -O ComfyUI/models/YOLO_MODEL/yolov8s-seg.pt
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8m-seg.pt -O ComfyUI/models/YOLO_MODEL/yolov8m-seg.pt
```

### æ¨¡åž‹é€‰æ‹©å»ºè®®ï¼š
- **yolov8n(-seg).pt**: Nanoæ¨¡åž‹ï¼Œæœ€å¿«ï¼Œç²¾åº¦é€‚ä¸­ï¼Œé€‚åˆå®žæ—¶åº”ç”¨
- **yolov8s(-seg).pt**: Smallæ¨¡åž‹ï¼Œå¹³è¡¡é€Ÿåº¦å’Œç²¾åº¦ï¼ŒæŽ¨èç”¨äºŽå¤§å¤šæ•°åº”ç”¨
- **yolov8m(-seg).pt**: Mediumæ¨¡åž‹ï¼Œæ›´é«˜ç²¾åº¦ï¼Œé€‚åˆå¯¹å‡†ç¡®æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯

### 3. é‡å¯ComfyUI

å®‰è£…å®ŒæˆåŽï¼Œé‡å¯ComfyUIä»¥åŠ è½½æ–°èŠ‚ç‚¹ã€‚

## ðŸŽ¯ ä½¿ç”¨æŒ‡å—

### YOLO Detection and Segmentation èŠ‚ç‚¹

#### è¾“å…¥å‚æ•°ï¼š
- **image**: è¾“å…¥å›¾åƒï¼ˆComfyUIå¼ é‡æ ¼å¼ï¼ŒBÃ—HÃ—WÃ—Cï¼‰
- **model_name**: YOLOæ¨¡åž‹åç§°ï¼ˆä»Ž`ComfyUI/models/YOLO_MODEL/`æ–‡ä»¶å¤¹è‡ªåŠ¨åŠ è½½ï¼‰
- **confidence_threshold**: æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼ (0.0-1.0, é»˜è®¤0.5)
- **filter_single_mask_by_class_id**: æŒ‰ç±»åˆ«IDè¿‡æ»¤åˆå¹¶æŽ©ç  (0-999, é»˜è®¤0)
- **use_class_name_for_single_mask**: å¯ç”¨ç±»åˆ«åç§°è¿‡æ»¤ï¼ˆå¸ƒå°”å€¼ï¼‰
  - å¯ç”¨æ—¶ï¼šæŒ‰ç±»åˆ«åç§°è¿‡æ»¤ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
  - ç¦ç”¨æ—¶ï¼šä½¿ç”¨ç±»åˆ«IDè¿‡æ»¤
- **class_name_for_single_mask**: ç›®æ ‡ç±»åˆ«åç§°ï¼ˆå½“å¯ç”¨åç§°è¿‡æ»¤æ—¶ï¼‰
  - æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚"person", "car", "dog"ç­‰
  - å¿…é¡»ä¸Žæ¨¡åž‹çš„ç±»åˆ«åç§°åŒ¹é…
- **smooth_masks**: å¯ç”¨æŽ©ç å¹³æ»‘ï¼ˆå¸ƒå°”å€¼ï¼‰
  - ä½¿ç”¨scipyçš„é«˜æ–¯æ»¤æ³¢è¿›è¡Œè¾¹ç¼˜å¹³æ»‘
- **smooth_sigma**: å¹³æ»‘å¼ºåº¦ (0.0-10.0, é»˜è®¤1.0)
  - å€¼è¶Šå¤§ï¼Œå¹³æ»‘æ•ˆæžœè¶Šå¼ºï¼ŒæŽ©ç è¾¹ç¼˜è¶ŠæŸ”å’Œ
- **force_output_mask**: å¼ºåˆ¶è¾“å‡ºæŽ©ç ï¼ˆå¸ƒå°”å€¼ï¼Œé»˜è®¤Trueï¼‰
  - å¯ç”¨æ—¶ï¼šå½“åˆ†å‰²æ¨¡åž‹æ— æŽ©ç æ—¶ï¼Œä½¿ç”¨è¾¹ç•Œæ¡†è‡ªåŠ¨ç”ŸæˆæŽ©ç 
  - ç¦ç”¨æ—¶ï¼šä»…ä½¿ç”¨æ¨¡åž‹åŽŸç”Ÿåˆ†å‰²æŽ©ç ï¼Œæ— å›žé€€æœºåˆ¶

#### è¾“å‡ºï¼š
- **PLOTTED_IMAGE**: å¸¦æ£€æµ‹æ¡†å’Œæ ‡ç­¾çš„å›¾åƒ
- **SINGLE_COMBINED_MASK**: å•ä¸ªåˆå¹¶æŽ©ç ï¼ˆå¯æŒ‰ç±»åˆ«è¿‡æ»¤ï¼‰
- **ALL_INDIVIDUAL_MASKS**: æ‰€æœ‰ç‹¬ç«‹å®žä¾‹æŽ©ç 
- **DETECTIONS_JSON**: åŒ…å«æ‰€æœ‰æ£€æµ‹ç»“æžœçš„JSONæ•°æ®

### Masked Image Effects èŠ‚ç‚¹

#### è¾“å…¥å‚æ•°ï¼š
- **image**: è¾“å…¥å›¾åƒï¼ˆComfyUIå¼ é‡æ ¼å¼ï¼‰
- **mask**: è¾“å…¥æŽ©ç ï¼ˆHÃ—Wæˆ–1Ã—HÃ—Wæˆ–1Ã—1Ã—HÃ—Wæ ¼å¼ï¼‰
- **effect_type**: æ•ˆæžœç±»åž‹
  - `gaussian_blur`: é«˜æ–¯æ¨¡ç³Šæ•ˆæžœ
  - `mosaic`: é©¬èµ›å…‹ï¼ˆåƒç´ åŒ–ï¼‰æ•ˆæžœ
- **apply_mode**: åº”ç”¨æ¨¡å¼
  - `masked_area`: æ•ˆæžœåº”ç”¨äºŽé®ç½©ç™½è‰²åŒºåŸŸï¼ˆå‰æ™¯ï¼‰
  - `unmasked_area`: æ•ˆæžœåº”ç”¨äºŽé®ç½©é»‘è‰²åŒºåŸŸï¼ˆèƒŒæ™¯ï¼‰
- **mosaic_pixel_size**: é©¬èµ›å…‹åƒç´ å—å¤§å° (2-256, é»˜è®¤16)
  - å€¼è¶Šå¤§ï¼Œåƒç´ å—è¶Šå¤§ï¼Œé©¬èµ›å…‹æ•ˆæžœè¶Šæ˜Žæ˜¾
- **gaussian_kernel_size**: é«˜æ–¯æ¨¡ç³Šæ ¸å¤§å° (3-255ï¼Œå¿…é¡»ä¸ºå¥‡æ•°ï¼Œé»˜è®¤25)
  - è‡ªåŠ¨è°ƒæ•´ä¸ºå¥‡æ•°ä»¥æ»¡è¶³è¦æ±‚
- **gaussian_sigma**: é«˜æ–¯æ¨¡ç³Šæ ‡å‡†å·® (0.1-20.0, é»˜è®¤5.0)
  - æŽ§åˆ¶æ¨¡ç³Šç¨‹åº¦ï¼Œå€¼è¶Šå¤§è¶Šæ¨¡ç³Š

#### è¾“å‡ºï¼š
- **IMAGE**: å¤„ç†åŽçš„å›¾åƒ

## ðŸ“‹ æ¨¡åž‹è¦æ±‚

### æ”¯æŒçš„æ¨¡åž‹æ ¼å¼ï¼š
- **æ£€æµ‹æ¨¡åž‹**: `yolov8n.pt`, `yolov8s.pt`, `yolov8m.pt`, `yolov8l.pt`, `yolov8x.pt`
- **åˆ†å‰²æ¨¡åž‹**: `yolov8n-seg.pt`, `yolov8s-seg.pt`, `yolov8m-seg.pt`, `yolov8l-seg.pt`, `yolov8x-seg.pt`

### æ¨¡åž‹æ”¾ç½®ä½ç½®ï¼š
```
ComfyUI/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ YOLO_MODEL/
â”‚       â”œâ”€â”€ yolov8s.pt
â”‚       â”œâ”€â”€ yolov8s-seg.pt
â”‚       â””â”€â”€ your_custom_model.pt
```

## ðŸ› ï¸ æŠ€æœ¯å®žçŽ°

### æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **å›¾åƒé¢„å¤„ç†**: å°†ComfyUIå¼ é‡(BÃ—HÃ—WÃ—C)è½¬æ¢ä¸ºPILå›¾åƒï¼Œç§»é™¤æ‰¹æ¬¡ç»´åº¦
2. **æ¨¡åž‹æŽ¨ç†**: ä½¿ç”¨Ultralytics YOLOv8è¿›è¡Œç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²æŽ¨ç†
3. **ç»“æžœå¤„ç†**:
   - è§£æžYOLOv8æ£€æµ‹ç»“æžœï¼Œæå–è¾¹ç•Œæ¡†ã€ç±»åˆ«ã€ç½®ä¿¡åº¦å’Œåˆ†å‰²æŽ©ç 
   - BGRè½¬RGBé¢œè‰²ç©ºé—´è½¬æ¢ï¼Œé€‚é…PILå’ŒComfyUI
   - è‡ªåŠ¨JSONåºåˆ—åŒ–æ£€æµ‹å…ƒæ•°æ®
4. **é«˜çº§æŽ©ç å¤„ç†**:
   - ç‹¬ç«‹å®žä¾‹æŽ©ç æå–å’Œå°ºå¯¸è°ƒæ•´
   - ç±»åˆ«è¿‡æ»¤çš„åˆå¹¶æŽ©ç ç”Ÿæˆ
   - scipy.ndimageé«˜æ–¯æ»¤æ³¢å¹³æ»‘å¤„ç†
   - è¾¹ç•Œæ¡†å›žé€€æœºåˆ¶ï¼ˆå½“æ— åˆ†å‰²æŽ©ç æ—¶ï¼‰
5. **å›¾åƒæ•ˆæžœåº”ç”¨**:
   - æ™ºèƒ½æŽ©ç å°ºå¯¸é€‚é…ï¼ˆä½¿ç”¨PIL LANCZOSé‡é‡‡æ ·ï¼‰
   - åŒºåŸŸé€‰æ‹©æ€§æ•ˆæžœåº”ç”¨ï¼ˆå‰æ™¯/èƒŒæ™¯ï¼‰
   - å¤šåŽç«¯é«˜æ–¯æ¨¡ç³Šï¼ˆtorchvisionä¼˜å…ˆï¼ŒPILé™çº§ï¼‰
   - åƒç´ çº§é©¬èµ›å…‹æ•ˆæžœå®žçŽ°
6. **è¾“å‡ºç”Ÿæˆ**: è¿”å›žæ ‡å‡†ComfyUIæ ¼å¼çš„å›¾åƒå’ŒæŽ©ç å¼ é‡

### æŠ€æœ¯ç‰¹æ€§ï¼š
- **å¼ é‡æ“ä½œä¼˜åŒ–**: ä½¿ç”¨torch.nn.functional.interpolateè¿›è¡Œé«˜æ•ˆçš„æŽ©ç å°ºå¯¸è°ƒæ•´
- **å†…å­˜ç®¡ç†**: æ™ºèƒ½çš„è®¾å¤‡åˆ†é…ï¼ˆCPU/GPUï¼‰ï¼Œé¿å…ä¸å¿…è¦çš„å†…å­˜æ‹·è´
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•èŽ·å’Œæ—¥å¿—è®°å½•æœºåˆ¶
- **å…¼å®¹æ€§é€‚é…**: è‡ªåŠ¨å¤„ç†ä¸åŒè¾“å…¥æ ¼å¼å’Œå°ºå¯¸
- **æ€§èƒ½ä¼˜åŒ–**:
  - GPUåŠ é€Ÿæ”¯æŒï¼ˆCUDAè‡ªåŠ¨æ£€æµ‹ï¼‰
  - å‘é‡åŒ–å¼ é‡æ“ä½œ
  - æ‰¹é‡å¤„ç†å°±ç»ª
  - å†…å­˜æ˜ å°„ä¼˜åŒ–

## ðŸ“– ç¤ºä¾‹å·¥ä½œæµ

é¡¹ç›®åŒ…å«ç¤ºä¾‹å·¥ä½œæµæ–‡ä»¶ï¼Œå±•ç¤ºäº†å¦‚ä½•å°†ä¸¤ä¸ªèŠ‚ç‚¹ç»“åˆä½¿ç”¨ï¼š

1. **YOLOæ£€æµ‹**: ä½¿ç”¨YOLOv8æ£€æµ‹å›¾åƒä¸­çš„ç›®æ ‡
2. **æŽ©ç å¤„ç†**: å¯¹æ£€æµ‹åˆ°çš„ç›®æ ‡åŒºåŸŸåº”ç”¨å›¾åƒæ•ˆæžœ
3. **ç»“æžœé¢„è§ˆ**: å®žæ—¶æŸ¥çœ‹å¤„ç†ç»“æžœ

### å¿«é€Ÿå¼€å§‹ï¼š
1. åŠ è½½ç¤ºä¾‹å·¥ä½œæµï¼š`example_workflows/detect and process.json`
2. é€‰æ‹©åˆé€‚çš„YOLOæ¨¡åž‹
3. è°ƒæ•´æ£€æµ‹å‚æ•°
4. é€‰æ‹©å›¾åƒæ•ˆæžœç±»åž‹
5. è¿è¡Œå·¥ä½œæµæŸ¥çœ‹ç»“æžœ

## ðŸ”§ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜ï¼š

**1. æ¨¡åž‹åŠ è½½å¤±è´¥**
- ç¡®ä¿æ¨¡åž‹æ–‡ä»¶å­˜åœ¨äºŽ `ComfyUI/models/YOLO_MODEL/` ç›®å½•
- æ£€æŸ¥æ¨¡åž‹æ–‡ä»¶æ˜¯å¦æŸåæˆ–ä¸å®Œæ•´ï¼ˆå»ºè®®é‡æ–°ä¸‹è½½ï¼‰
- ç¡®è®¤æ¨¡åž‹æ–‡ä»¶åæ‹¼å†™æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- éªŒè¯æ¨¡åž‹æ ¼å¼æ˜¯å¦ä¸º.ptæ–‡ä»¶
- æŸ¥çœ‹ComfyUIç»ˆç«¯æ—¥å¿—ï¼Œæ£€æŸ¥è¯¦ç»†é”™è¯¯ä¿¡æ¯

**2. CUDA/GPUç›¸å…³é”™è¯¯**
- ç¡®ä¿PyTorch CUDAç‰ˆæœ¬ä¸Žç³»ç»ŸCUDAç‰ˆæœ¬å…¼å®¹
- æ£€æŸ¥GPUå†…å­˜æ˜¯å¦å……è¶³ï¼ˆå¤§æ¨¡åž‹éœ€è¦æ›´å¤šæ˜¾å­˜ï¼‰
- å°è¯•åœ¨CPUæ¨¡å¼ä¸‹è¿è¡Œï¼š`force_output_mask`è®¾ä¸ºFalseä»¥å‡å°‘æ˜¾å­˜å ç”¨
- æ›´æ–°æ˜¾å¡é©±åŠ¨åˆ°æœ€æ–°ç‰ˆæœ¬
- æ£€æŸ¥CUDA Toolkitæ˜¯å¦æ­£ç¡®å®‰è£…

**3. æŽ©ç å°ºå¯¸ä¸åŒ¹é…**
- èŠ‚ç‚¹ä¼šè‡ªåŠ¨å¤„ç†å°ºå¯¸ä¸åŒ¹é…é—®é¢˜ï¼ˆä½¿ç”¨åŒçº¿æ€§æ’å€¼ï¼‰
- æ£€æŸ¥ComfyUIæ—¥å¿—ä¸­çš„å°ºå¯¸è°ƒæ•´ä¿¡æ¯
- ç¡®ä¿è¾“å…¥å›¾åƒä¸ºæœ‰æ•ˆçš„RGB/BGRæ ¼å¼
- å¦‚éœ€ç²¾ç¡®æŽ§åˆ¶ï¼Œå¯ä½¿ç”¨ComfyUIçš„ResizeèŠ‚ç‚¹é¢„å¤„ç†

**4. æ£€æµ‹ç»“æžœä¸ºç©ºæˆ–æ— æŽ©ç **
- **é™ä½Žç½®ä¿¡åº¦é˜ˆå€¼**ï¼ˆä»Ž0.5é™ä½Žåˆ°0.1-0.3ï¼‰
- **æ£€æŸ¥æ¨¡åž‹ç±»åž‹**ï¼š
  - ä½¿ç”¨-seg.ptæ¨¡åž‹èŽ·å–åˆ†å‰²æŽ©ç 
  - ä½¿ç”¨.ptæ¨¡åž‹ä»…èŽ·å–è¾¹ç•Œæ¡†
- **éªŒè¯ç›®æ ‡ç±»åˆ«**ï¼š
  - ç¡®è®¤å›¾åƒä¸­çš„ç›®æ ‡ä¸Žæ¨¡åž‹è®­ç»ƒç±»åˆ«åŒ¹é…
  - æ£€æŸ¥ç±»åˆ«åç§°å¤§å°å†™æ˜¯å¦æ­£ç¡®
- **å¯ç”¨force_output_mask**ï¼šå½“åˆ†å‰²æ¨¡åž‹æ— æŽ©ç æ—¶ä½¿ç”¨è¾¹ç•Œæ¡†ç”Ÿæˆ
- **æ£€æŸ¥å›¾åƒè´¨é‡**ï¼šå…‰ç…§ã€å¯¹æ¯”åº¦ã€ç›®æ ‡å¤§å°ç­‰å› ç´ 

**5. å†…å­˜ä¸è¶³é”™è¯¯**
- å‡å°æ¨¡åž‹å¤§å°ï¼ˆn->s->m->lï¼‰
- é™ä½Žæ‰¹æ¬¡å¤§å°æˆ–å›¾åƒåˆ†è¾¨çŽ‡
- å¯ç”¨`force_output_mask`ä»¥å‡å°‘å†…å­˜å ç”¨
- é‡å¯ComfyUIé‡Šæ”¾å†…å­˜
- ç›‘æŽ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

**6. ç±»åˆ«è¿‡æ»¤ä¸å·¥ä½œ**
- **ç±»åˆ«åç§°è¿‡æ»¤**ï¼š
  - ç¡®ä¿ç±»åˆ«åç§°ä¸Žæ¨¡åž‹å®šä¹‰å®Œå…¨åŒ¹é…
  - å°è¯•ä¸åŒçš„å¤§å°å†™ç»„åˆ
  - æŸ¥çœ‹æ¨¡åž‹çš„ç±»åˆ«åˆ—è¡¨ï¼š`model.names`
- **ç±»åˆ«IDè¿‡æ»¤**ï¼š
  - ç¡®è®¤ç±»åˆ«IDåœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆ0-999ï¼‰
  - æŸ¥çœ‹DETECTIONS_JSONè¾“å‡ºç¡®è®¤å®žé™…æ£€æµ‹åˆ°çš„ç±»åˆ«

**7. æŽ©ç å¹³æ»‘æ•ˆæžœä¸æ˜Žæ˜¾**
- å¢žåŠ `smooth_sigma`å€¼ï¼ˆå»ºè®®1.0-3.0ï¼‰
- ç¡®ä¿è¾“å…¥æŽ©ç æœ‰æ¸…æ™°çš„è¾¹ç¼˜
- æ£€æŸ¥æŽ©ç æ•°æ®ç±»åž‹å’ŒèŒƒå›´ï¼ˆåº”ä¸º0-1æµ®ç‚¹æ•°ï¼‰

**8. æ•ˆæžœèŠ‚ç‚¹å°ºå¯¸é€‚é…é—®é¢˜**
- èŠ‚ç‚¹è‡ªåŠ¨å¤„ç†å°ºå¯¸ä¸åŒ¹é…
- æ£€æŸ¥ComfyUIæ—¥å¿—ä¸­çš„resizeä¿¡æ¯
- ç¡®ä¿maskè¾“å…¥ä¸ºæ­£ç¡®çš„å¼ é‡æ ¼å¼
- éªŒè¯imageå’Œmaskçš„è®¾å¤‡ä¸€è‡´æ€§ï¼ˆCPU/GPUï¼‰

## ðŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿Žæäº¤Issueå’ŒPull Requestï¼

### å¼€å‘çŽ¯å¢ƒè®¾ç½®ï¼š
```bash
git clone https://github.com/gasdyueer/comfyui-yolo-mask-process.git
cd comfyui-yolo-mask-process
pip install -e .
```

## ðŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

## ðŸ™ è‡´è°¢

- [Ultralytics YOLOv8](https://github.com/ultralytics/ultralytics) - æä¾›å¼ºå¤§çš„ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²åŠŸèƒ½
- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - ä¼˜ç§€çš„AIå›¾åƒå¤„ç†æ¡†æž¶
- [PyTorch](https://pytorch.org/) - æ·±åº¦å­¦ä¹ æ¡†æž¶

## ðŸ“ž æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹[Issues](https://github.com/gasdyueer/comfyui-yolo-mask-process/issues)é¡µé¢
2. åˆ›å»ºæ–°çš„Issueæè¿°æ‚¨çš„é—®é¢˜
3. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå¤çŽ°æ­¥éª¤

---

**ç‰ˆæœ¬**: 0.1.0
**å…¼å®¹æ€§**: ComfyUI
**Python**: >=3.11