# ComfyUI YOLO Mask Process

ä¸€ä¸ªå¼ºå¤§çš„ComfyUIè‡ªå®šä¹‰èŠ‚ç‚¹é¡¹ç›®ï¼Œé›†æˆäº†YOLOv8ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²åŠŸèƒ½ï¼Œå¹¶æä¾›çµæ´»çš„å›¾åƒé®ç½©æ•ˆæžœå¤„ç†ã€‚

## ðŸš€ åŠŸèƒ½ç‰¹æ€§

### YOLO Detection and Segmentation èŠ‚ç‚¹
- **å¤šæ¨¡åž‹æ”¯æŒ**ï¼šæ”¯æŒYOLOv8æ£€æµ‹å’Œåˆ†å‰²æ¨¡åž‹
- **æ™ºèƒ½æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å›¾åƒä¸­çš„ç›®æ ‡å¹¶ç”Ÿæˆè¾¹ç•Œæ¡†
- **åˆ†å‰²æ”¯æŒ**ï¼šæ”¯æŒå®žä¾‹åˆ†å‰²ï¼Œç”Ÿæˆé«˜è´¨é‡çš„åˆ†å‰²æŽ©ç 
- **çµæ´»è¿‡æ»¤**ï¼šæ”¯æŒæŒ‰ç±»åˆ«IDæˆ–ç±»åˆ«åç§°è¿‡æ»¤ç‰¹å®šç›®æ ‡
- **ç½®ä¿¡åº¦æŽ§åˆ¶**ï¼šå¯è°ƒèŠ‚æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼
- **æŽ©ç å¹³æ»‘**ï¼šå¯é€‰çš„é«˜æ–¯å¹³æ»‘åŠŸèƒ½ï¼Œæå‡æŽ©ç è´¨é‡
- **è¯¦ç»†è¾“å‡º**ï¼šæä¾›å¸¦æ ‡æ³¨å›¾åƒã€åˆå¹¶æŽ©ç ã€ç‹¬ç«‹æŽ©ç å’Œæ£€æµ‹ç»“æžœJSON

### Masked Image Effects èŠ‚ç‚¹
- **å¤šæ ·æ•ˆæžœ**ï¼šæ”¯æŒé«˜æ–¯æ¨¡ç³Šã€é©¬èµ›å…‹ç­‰å›¾åƒæ•ˆæžœ
- **çµæ´»åº”ç”¨**ï¼šå¯åº”ç”¨äºŽé®ç½©åŒºåŸŸæˆ–éžé®ç½©åŒºåŸŸ
- **å‚æ•°å¯è°ƒ**ï¼šæ‰€æœ‰æ•ˆæžœå‚æ•°å‡å¯ç²¾ç¡®æŽ§åˆ¶
- **å®žæ—¶é¢„è§ˆ**ï¼šæ”¯æŒComfyUIå®žæ—¶é¢„è§ˆæ•ˆæžœ

## ðŸ“¦ å®‰è£…æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®åˆ°ComfyUIçš„custom_nodesç›®å½•
cd ComfyUI/custom_nodes
git clone https://github.com/gasdyueer/comfyui-yolo-mask-process.git

# å®‰è£…Pythonä¾èµ–
pip install ultralytics torch torchvision scipy pillow numpy
```

### 2. ä¸‹è½½YOLOv8æ¨¡åž‹

å°†YOLOv8æ¨¡åž‹æ–‡ä»¶æ”¾å…¥ `ComfyUI/models/YOLO_MODEL/` ç›®å½•ï¼š

```bash
# åˆ›å»ºæ¨¡åž‹ç›®å½•
mkdir -p ComfyUI/models/YOLO_MODEL

# ä¸‹è½½æ¨¡åž‹ï¼ˆä¾‹å¦‚YOLOv8sæ£€æµ‹æ¨¡åž‹ï¼‰
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8s.pt -O ComfyUI/models/YOLO_MODEL/yolov8s.pt

# ä¸‹è½½åˆ†å‰²æ¨¡åž‹ï¼ˆå¯é€‰ï¼‰
wget https://github.com/ultralytics/assets/releases/download/v8.2.0/yolov8s-seg.pt -O ComfyUI/models/YOLO_MODEL/yolov8s-seg.pt
```

### 3. é‡å¯ComfyUI

å®‰è£…å®ŒæˆåŽï¼Œé‡å¯ComfyUIä»¥åŠ è½½æ–°èŠ‚ç‚¹ã€‚

## ðŸŽ¯ ä½¿ç”¨æŒ‡å—

### YOLO Detection and Segmentation èŠ‚ç‚¹

#### è¾“å…¥å‚æ•°ï¼š
- **image**: è¾“å…¥å›¾åƒï¼ˆå¼ é‡æ ¼å¼ï¼‰
- **model_name**: YOLOæ¨¡åž‹åç§°ï¼ˆä»ŽYOLO_MODELæ–‡ä»¶å¤¹é€‰æ‹©ï¼‰
- **confidence_threshold**: æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼ (0.0-1.0)
- **filter_single_mask_by_class_id**: æŒ‰ç±»åˆ«IDè¿‡æ»¤ (0-999)
- **use_class_name_for_single_mask**: å¯ç”¨ç±»åˆ«åç§°è¿‡æ»¤
- **class_name_for_single_mask**: ç±»åˆ«åç§°ï¼ˆå½“å¯ç”¨åç§°è¿‡æ»¤æ—¶ï¼‰
- **smooth_masks**: å¯ç”¨æŽ©ç å¹³æ»‘
- **smooth_sigma**: å¹³æ»‘å¼ºåº¦ (0.0-10.0)

#### è¾“å‡ºï¼š
- **PLOTTED_IMAGE**: å¸¦æ£€æµ‹æ¡†å’Œæ ‡ç­¾çš„å›¾åƒ
- **SINGLE_COMBINED_MASK**: å•ä¸ªåˆå¹¶æŽ©ç ï¼ˆå¯æŒ‰ç±»åˆ«è¿‡æ»¤ï¼‰
- **ALL_INDIVIDUAL_MASKS**: æ‰€æœ‰ç‹¬ç«‹å®žä¾‹æŽ©ç 
- **DETECTIONS_JSON**: åŒ…å«æ‰€æœ‰æ£€æµ‹ç»“æžœçš„JSONæ•°æ®

### Masked Image Effects èŠ‚ç‚¹

#### è¾“å…¥å‚æ•°ï¼š
- **image**: è¾“å…¥å›¾åƒ
- **mask**: è¾“å…¥æŽ©ç 
- **effect_type**: æ•ˆæžœç±»åž‹
  - `gaussian_blur`: é«˜æ–¯æ¨¡ç³Š
  - `mosaic`: é©¬èµ›å…‹æ•ˆæžœ
- **apply_mode**: åº”ç”¨æ¨¡å¼
  - `masked_area`: åº”ç”¨äºŽé®ç½©ç™½è‰²åŒºåŸŸ
  - `unmasked_area`: åº”ç”¨äºŽé®ç½©é»‘è‰²åŒºåŸŸ
- **mosaic_pixel_size**: é©¬èµ›å…‹åƒç´ å¤§å° (2-256)
- **gaussian_kernel_size**: é«˜æ–¯æ ¸å¤§å° (3-255ï¼Œå¿…é¡»ä¸ºå¥‡æ•°)
- **gaussian_sigma**: é«˜æ–¯æ ‡å‡†å·® (0.1-20.0)

#### è¾“å‡ºï¼š
- **IMAGE**: å¤„ç†åŽçš„å›¾åƒ

## ðŸ“‹ æ¨¡åž‹è¦æ±‚

### æ”¯æŒçš„æ¨¡åž‹æ ¼å¼ï¼š
- **æ£€æµ‹æ¨¡åž‹**: `yolov8n.pt`, `yolov8s.pt`, `yolov8m.pt`, `yolov8l.pt`, `yolov8x.pt`
- **åˆ†å‰²æ¨¡åž‹**: `yolov8n-seg.pt`, `yolov8s-seg.pt`, `yolov8m-seg.pt`, `yolov8l-seg.pt`, `yolov8x-seg.pt`

### æ¨¡åž‹æ”¾ç½®ä½ç½®ï¼š
```
ComfyUI/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ YOLO_MODEL/
â”‚       â”œâ”€â”€ yolov8s.pt
â”‚       â”œâ”€â”€ yolov8s-seg.pt
â”‚       â””â”€â”€ your_custom_model.pt
```

## ðŸ› ï¸ æŠ€æœ¯å®žçŽ°

### æ ¸å¿ƒåŠŸèƒ½ï¼š
1. **å›¾åƒé¢„å¤„ç†**: å°†ComfyUIå¼ é‡è½¬æ¢ä¸ºPILå›¾åƒæ ¼å¼
2. **æ¨¡åž‹æŽ¨ç†**: ä½¿ç”¨Ultralytics YOLOv8è¿›è¡Œç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²
3. **ç»“æžœå¤„ç†**: è§£æžæ£€æµ‹ç»“æžœï¼Œç”ŸæˆæŽ©ç å’Œæ ‡æ³¨å›¾åƒ
4. **æ•ˆæžœåº”ç”¨**: åŸºäºŽæŽ©ç å¯¹å›¾åƒåº”ç”¨å„ç§è§†è§‰æ•ˆæžœ
5. **è¾“å‡ºç”Ÿæˆ**: è¿”å›žå¤„ç†åŽçš„å›¾åƒå’Œç›¸å…³æ•°æ®

### æ€§èƒ½ä¼˜åŒ–ï¼š
- GPUåŠ é€Ÿæ”¯æŒï¼ˆå½“CUDAå¯ç”¨æ—¶ï¼‰
- å†…å­˜é«˜æ•ˆçš„å¼ é‡æ“ä½œ
- å¯é…ç½®çš„ç½®ä¿¡åº¦é˜ˆå€¼
- æ‰¹é‡å¤„ç†æ”¯æŒ

## ðŸ“– ç¤ºä¾‹å·¥ä½œæµ

é¡¹ç›®åŒ…å«ç¤ºä¾‹å·¥ä½œæµæ–‡ä»¶ï¼Œå±•ç¤ºäº†å¦‚ä½•å°†ä¸¤ä¸ªèŠ‚ç‚¹ç»“åˆä½¿ç”¨ï¼š

1. **YOLOæ£€æµ‹**: ä½¿ç”¨YOLOv8æ£€æµ‹å›¾åƒä¸­çš„ç›®æ ‡
2. **æŽ©ç å¤„ç†**: å¯¹æ£€æµ‹åˆ°çš„ç›®æ ‡åŒºåŸŸåº”ç”¨å›¾åƒæ•ˆæžœ
3. **ç»“æžœé¢„è§ˆ**: å®žæ—¶æŸ¥çœ‹å¤„ç†ç»“æžœ

### å¿«é€Ÿå¼€å§‹ï¼š
1. åŠ è½½ç¤ºä¾‹å·¥ä½œæµï¼š`example_workflows/detect and process.json`
2. é€‰æ‹©åˆé€‚çš„YOLOæ¨¡åž‹
3. è°ƒæ•´æ£€æµ‹å‚æ•°
4. é€‰æ‹©å›¾åƒæ•ˆæžœç±»åž‹
5. è¿è¡Œå·¥ä½œæµæŸ¥çœ‹ç»“æžœ

## ðŸ”§ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜ï¼š

**1. æ¨¡åž‹åŠ è½½å¤±è´¥**
- ç¡®ä¿æ¨¡åž‹æ–‡ä»¶å­˜åœ¨äºŽ `ComfyUI/models/YOLO_MODEL/` ç›®å½•
- æ£€æŸ¥æ¨¡åž‹æ–‡ä»¶æ˜¯å¦æŸå
- ç¡®è®¤æ¨¡åž‹æ–‡ä»¶åæ‹¼å†™æ­£ç¡®

**2. CUDAé”™è¯¯**
- ç¡®ä¿PyTorch CUDAç‰ˆæœ¬ä¸Žç³»ç»ŸCUDAç‰ˆæœ¬å…¼å®¹
- æ£€æŸ¥GPUå†…å­˜æ˜¯å¦å……è¶³
- å°è¯•åœ¨CPUæ¨¡å¼ä¸‹è¿è¡Œï¼ˆä¼šè¾ƒæ…¢ï¼‰

**3. æŽ©ç å°ºå¯¸ä¸åŒ¹é…**
- èŠ‚ç‚¹ä¼šè‡ªåŠ¨å¤„ç†å°ºå¯¸ä¸åŒ¹é…é—®é¢˜
- æ£€æŸ¥è¾“å…¥å›¾åƒå’ŒæŽ©ç çš„å°ºå¯¸
- å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ComfyUIçš„ResizeèŠ‚ç‚¹é¢„å¤„ç†

**4. æ£€æµ‹ç»“æžœä¸ºç©º**
- é™ä½Žç½®ä¿¡åº¦é˜ˆå€¼
- æ£€æŸ¥æ¨¡åž‹æ˜¯å¦æ”¯æŒå½“å‰å›¾åƒä¸­çš„ç›®æ ‡ç±»åˆ«
- ç¡®è®¤å›¾åƒè´¨é‡å’Œå…‰ç…§æ¡ä»¶

## ðŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿Žæäº¤Issueå’ŒPull Requestï¼

### å¼€å‘çŽ¯å¢ƒè®¾ç½®ï¼š
```bash
git clone https://github.com/gasdyueer/comfyui-yolo-mask-process.git
cd comfyui-yolo-mask-process
pip install -e .
```

## ðŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

## ðŸ™ è‡´è°¢

- [Ultralytics YOLOv8](https://github.com/ultralytics/ultralytics) - æä¾›å¼ºå¤§çš„ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²åŠŸèƒ½
- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - ä¼˜ç§€çš„AIå›¾åƒå¤„ç†æ¡†æž¶
- [PyTorch](https://pytorch.org/) - æ·±åº¦å­¦ä¹ æ¡†æž¶

## ðŸ“ž æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹[Issues](https://github.com/gasdyueer/comfyui-yolo-mask-process/issues)é¡µé¢
2. åˆ›å»ºæ–°çš„Issueæè¿°æ‚¨çš„é—®é¢˜
3. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå¤çŽ°æ­¥éª¤

---

**ç‰ˆæœ¬**: 0.1.0
**å…¼å®¹æ€§**: ComfyUI 1.0+
**Python**: >=3.11